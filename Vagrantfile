# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  # Basic Config
  config.vm.box = "ubuntu/bionic64"
  config.disksize.size = '60GB'

  config.vm.define "PentestEnv"
  config.ssh.insert_key = false

  # General networking
  config.vm.network "private_network", type: "dhcp"  

  

  # VirtualBox Specific
  config.vm.provider :virtualbox do |v|
    v.name = "PentestVM"

    # VirtualBox Hardware specs
    v.memory = 8192
    v.cpus = 8
    v.gui = true

    # VirtualBox Networking
    #v.customize ["modifyvm", :id, "--natdnshostresolver1", "on"]
    v.customize ["modifyvm", :id, "--natdnsproxy1", "on"]
    v.customize ["modifyvm", :id, "--ioapic", "on"]
  end

  # VirtualBox Guest Additions
  config.vbguest.no_remote = true


  # Provisioning with Ansible Local
  config.vm.provision "ansible_local" do |ansible|
    ansible.playbook = "playbooks/main.yml"
    ansible.install        = true

    # Ansible Galaxy provisioning
    roles_file = 'requirements.yml'
      if File.exist?(roles_file) && !Psych.load_file(roles_file, nil).equal?(nil)
        ansible.galaxy_role_file = roles_file
        ansible.galaxy_roles_path = '/home/vagrant/.ansible/roles/'
        ansible.galaxy_command = 'ansible-galaxy install --role-file=%{role_file} --roles-path=%{roles_path}'
      end
  end
end
